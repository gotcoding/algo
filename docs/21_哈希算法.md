# 哈希算法

将任意长度的二进制值串映射为固定长度的二进制值串，这个映射的规则就是`哈希算法`，而通过原始数据映射之后得到的二进制值串就是`哈希值`。它的特点是：
* 从哈希值不能反推出原始数据；
* 对输入非常敏感，改动一点结果就大不相同；
* 执行效率要高，针对较长的文本也能很快算出来。

## 应用

### 唯一性标识
对文件进行哈希运算获取指纹（哈希值），哈希算法可以对大数据做信息摘要，通过一个较短的二进制编码来表示很大的数据。比如比对图片和大文件。

### 数据校验
用于校验数据的完整性和正确性。比如文件分割后BT下载，比特币地址中都使用了数据校验。

### 散列函数
散列函数也是哈希算法的一种应用。散列函数对于散列算法冲突的要求要低很多。散列函数用的散列算法一般都比较简单，比较追求效率。

### 负载均衡
那如何才能实现一个`会话粘滞（session sticky）`的负载均衡算法呢？也就是说，我们需要在同一个客户端上，在一次会话中的所有请求都路由到同一个服务器上。我们可以通过哈希算法，对客户端 IP 地址或者会话 ID 计算哈希值，将取得的哈希值与服务器列表的大小进行取模运算，最终得到的值就是应该被路由到的服务器编号。

### 数据分片
针对这种海量数据的处理问题，我们都可以采用多机分布式处理。借助这种分片的思路，可以突破单机内存、CPU 等资源的限制。
比如如何在有 1 亿张图片图库中查找？当我们要判断一个图片是否在图库中的时候，我们通过同样的哈希算法，计算这个图片的唯一标识，然后与机器个数 n 求余取模。假设得到的值是 k，那就去编号 k 的机器构建的散列表中查找。


### 分布式存储
需要将海量都数据分布在多台机器上，该如何决定将哪个数据放到哪个机器上呢？我们可以借用前面数据分片的思想，即通过哈希算法对数据取哈希值，然后对机器个数取模，这个最终值就是应该存储的缓存机器编号。当机器增减时如何自动扩容？这时候，`一致性哈希算法`就要登场了。假设我们有 k 个机器，数据的哈希值的范围是[0, MAX]。我们将整个范围划分成 m 个小区间（m 远大于 k），每个机器负责 m/k 个小区间。当有新机器加入的时候，我们就将某几个小区间的数据，从原来的机器中搬移到新的机器中。这样，既不用全部重新哈希、搬移数据，也保持了各个机器上数据数量的均衡。